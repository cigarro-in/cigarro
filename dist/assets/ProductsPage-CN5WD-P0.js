import{r as e,j as s}from"./ui-DmSYmwlh.js";import{u as t,n as a,a as r,_ as i,t as n,s as c,H as d,Z as o}from"./index-sG1ZoleV.js";import{G as l,L as m}from"./list-cBP1F4cr.js";import{C as u,a as x}from"./chevron-up-BjPB7NKs.js";import{S as h}from"./shopping-cart-D8ThiKve.js";import"./vendor-CTYTkcnE.js";import"./supabase-CLG-Fze1.js";function p(){t();const p=a(),[g,f]=e.useState([]),[b,j]=e.useState(!0),[k,N]=e.useState(1),[w,v]=e.useState("name"),[y,S]=e.useState("grid"),[E,C]=e.useState(""),[_,L]=e.useState([]),[T,P]=e.useState([]),[z,O]=e.useState([]),[q,D]=e.useState([]),[F,A]=e.useState([]),[M,R]=e.useState([]),[B,I]=e.useState([]),[W,$]=e.useState([]),[H,U]=e.useState([]),[G,K]=e.useState([]),[Q,Z]=e.useState([]),[V,Y]=e.useState(!1),[J,X]=e.useState(!1),{addToCart:ee,isLoading:se}=r(),{isWishlisted:te,toggleWishlist:ae}=i(),[re,ie]=e.useState([]),ne=new URLSearchParams(p.search).get("search")||"";e.useEffect(()=>{const e=setTimeout(()=>{b&&(console.error("Loading timeout - setting loading to false"),j(!1),n.error("Loading timeout. Please refresh the page."))},1e4);return(async()=>{try{console.log("Testing database connection...");const{data:e,error:s}=await c.from("products").select("id").limit(1);if(s)return console.error("Database connection failed:",s),n.error("Database connection failed. Please check your configuration."),void j(!1);console.log("Database connection successful"),await Promise.all([de(),ce()])}catch(e){console.error("Error loading data:",e),j(!1)}})(),()=>clearTimeout(e)},[ne]),e.useEffect(()=>{const e=setTimeout(()=>{de()},300);return()=>clearTimeout(e)},[M,B,W,H,G,Q]),e.useEffect(()=>{const e=[{id:"styles",name:"STYLES",items:["Pendant Light","Multi Light","Wall Mount","Ceiling Light","Stone","Linear","Free-Standing","Built-in","Objects","Tala bulbs"],isExpanded:re.find(e=>"styles"===e.id)?.isExpanded??!1},{id:"moods",name:"MOODS",items:["Minimalist","Contemporary","Scandinavian","Organic","Post Modern","Farmhouse","Luxe"],isExpanded:re.find(e=>"moods"===e.id)?.isExpanded??!1},{id:"collections",name:"COLLECTIONS",items:["Stone","Pivoine","Onyx","Coquelicot","Danoise","Flora","Nomad","Luxe","Nopal","Linear","Quick Ship","Classics","Chrome","Hospitality","Outdoor"],isExpanded:re.find(e=>"collections"===e.id)?.isExpanded??!0},{id:"rooms",name:"ROOMS",items:["Living Room","Kitchen","Dining room","Bathroom","Bedroom","Entrance Hall","Corridor","Exterior","Staircase"],isExpanded:re.find(e=>"rooms"===e.id)?.isExpanded??!1},{id:"brands",name:"BRANDS",items:T.map(e=>`${e.brand} (${e.count})`),isExpanded:re.find(e=>"brands"===e.id)?.isExpanded??!1},{id:"origins",name:"ORIGINS",items:z,isExpanded:re.find(e=>"origins"===e.id)?.isExpanded??!1},{id:"strengths",name:"STRENGTHS",items:q,isExpanded:re.find(e=>"strengths"===e.id)?.isExpanded??!1},{id:"pack-sizes",name:"PACK SIZES",items:F,isExpanded:re.find(e=>"pack-sizes"===e.id)?.isExpanded??!1},{id:"price-range",name:"PRICE RANGE",items:["Under ₹500","₹500 - ₹1000","₹1000 - ₹2000","₹2000 - ₹5000","Above ₹5000"],isExpanded:re.find(e=>"price-range"===e.id)?.isExpanded??!1},{id:"quick-ship",name:"QUICK SHIP",items:["Quick ship"],isExpanded:re.find(e=>"quick-ship"===e.id)?.isExpanded??!1}].filter(e=>e.items.length>0);ie(e)},[_,T,z,q,F]);const ce=async()=>{try{console.log("Fetching filter data...");const{data:e,error:s}=await c.from("categories").select("id, name, slug").order("name");s?console.error("Categories error:",s):(console.log("Categories loaded:",e?.length||0),L(e||[]));const{data:t}=await c.from("products").select("brand").eq("is_active",!0);if(t){const e=t.reduce((e,s)=>(e[s.brand]=(e[s.brand]||0)+1,e),{}),s=Object.entries(e).map(([e,s])=>({brand:e,count:s})).sort((e,s)=>e.brand.localeCompare(s.brand));P(s)}const{data:a}=await c.from("products").select("origin").eq("is_active",!0).not("origin","is",null);if(a){const e=[...new Set(a.map(e=>e.origin).filter(Boolean))].sort();O(e)}const{data:r}=await c.from("products").select("strength").eq("is_active",!0).not("strength","is",null);if(r){const e=[...new Set(r.map(e=>e.strength).filter(Boolean))].sort();D(e)}const{data:i}=await c.from("products").select("pack_size").eq("is_active",!0).not("pack_size","is",null);if(i){const e=[...new Set(i.map(e=>e.pack_size).filter(Boolean))].sort();A(e)}}catch(e){console.error("Error fetching filter data:",e)}},de=async()=>{Y(!0);try{console.log("Fetching products...");let e=c.from("products").select("\n          id, name, slug, brand, price, description, is_active, gallery_images, rating, review_count, created_at,\n          origin, strength, pack_size,\n          product_categories (\n            categories (id, name, slug)\n          )\n        ").eq("is_active",!0);if(ne.trim()&&(e=e.or(`name.ilike.%${ne}%,brand.ilike.%${ne}%,description.ilike.%${ne}%`)),M.length>0&&(e=e.in("product_categories.categories.name",M)),B.length>0&&(e=e.in("brand",B)),W.length>0&&(e=e.in("origin",W)),H.length>0&&(e=e.in("strength",H)),G.length>0&&(e=e.in("pack_size",G)),Q.length>0){const s=Q.map(e=>{switch(e){case"Under ₹500":return"price.lt.50000";case"₹500 - ₹1000":return"price.gte.50000,price.lt.100000";case"₹1000 - ₹2000":return"price.gte.100000,price.lt.200000";case"₹2000 - ₹5000":return"price.gte.200000,price.lt.500000";case"Above ₹5000":return"price.gte.500000";default:return""}}).filter(Boolean);s.length>0&&(e=e.or(s.join(",")))}const{data:s,error:t}=await e.order("created_at",{ascending:!1});if(t)throw console.error("Products query error:",t),t;console.log("Products loaded:",s?.length||0),f(s||[])}catch(e){console.error("Error fetching products:",e),n.error("Failed to load products")}finally{Y(!1),j(!1)}},oe=async e=>{try{await ee(e,1),n.success(`${e.name} added to cart!`)}catch(s){n.error("Failed to add to cart")}},le=e=>{ie(s=>s.map(s=>s.id===e?{...s,isExpanded:!s.isExpanded}:s))},me=(e,s,t)=>{switch(e){case"styles":R(e=>t?[...e,s]:e.filter(e=>e!==s));break;case"moods":I(e=>t?[...e,s]:e.filter(e=>e!==s));break;case"collections":case"origins":$(e=>t?[...e,s]:e.filter(e=>e!==s));break;case"rooms":case"strengths":U(e=>t?[...e,s]:e.filter(e=>e!==s));break;case"brands":case"pack-sizes":K(e=>t?[...e,s]:e.filter(e=>e!==s));break;case"price-range":case"quick-ship":Z(e=>t?[...e,s]:e.filter(e=>e!==s))}},ue=[...g].sort((e,s)=>{switch(w){case"price-low":return e.price-s.price;case"price-high":return s.price-e.price;case"rating":return(s.rating||0)-(e.rating||0);case"newest":return new Date(s.created_at||0).getTime()-new Date(e.created_at||0).getTime();default:return e.name.localeCompare(s.name)}}),xe=ue.slice(12*(k-1),12*k),he=Math.ceil(ue.length/12);return b?s.jsx("div",{className:"min-h-screen bg-creme flex items-center justify-center",children:s.jsxs("div",{className:"text-center",children:[s.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-dark"}),s.jsx("p",{className:"text-dark mt-4 font-sans",children:"Loading premium products..."}),s.jsx("p",{className:"text-dark/60 mt-2 font-sans text-sm",children:"Connecting to database..."})]})}):s.jsxs(s.Fragment,{children:[s.jsxs(d,{children:[s.jsx("title",{children:"All our products - Cigarro"}),s.jsx("meta",{name:"description",content:"Discover our complete collection of premium cigarettes, cigars, and tobacco products from world-renowned brands."})]}),s.jsxs("div",{className:"min-h-screen bg-creme",children:[s.jsx("div",{className:"main-container",children:s.jsx("div",{className:"title-wrapper text-center py-16",children:s.jsx("h1",{className:"main-title",children:"All our products"})})}),s.jsx("div",{className:"main-container mb-8",children:s.jsxs("div",{className:"flex justify-between items-center",children:[s.jsxs("div",{className:"text-dark font-sans font-medium text-lg uppercase tracking-wide",children:[ue.length," PRODUCTS"]}),s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("span",{className:"text-dark font-sans font-medium text-lg uppercase tracking-wide",children:"VIEW"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:()=>S("grid"),className:"p-2 rounded "+("grid"===y?"bg-dark text-creme-light":"bg-creme-light text-dark border border-coyote"),children:s.jsx(l,{className:"w-5 h-5"})}),s.jsx("button",{onClick:()=>S("list"),className:"p-2 rounded "+("list"===y?"bg-dark text-creme-light":"bg-creme-light text-dark border border-coyote"),children:s.jsx(m,{className:"w-5 h-5"})})]})]})]})}),s.jsxs("div",{className:"main-container",children:[s.jsx("div",{className:"lg:hidden mb-6",children:s.jsxs("button",{onClick:()=>X(!J),className:"flex items-center gap-2 text-dark font-sans font-medium text-lg uppercase tracking-wide",children:[s.jsx("span",{children:"Filters"}),s.jsx(u,{className:"w-5 h-5 transition-transform "+(J?"rotate-180":"")})]})}),s.jsxs("div",{className:"flex gap-8",children:[s.jsx("div",{className:"hidden lg:block w-80 flex-shrink-0",children:s.jsx("div",{className:"space-y-0",children:re.map((e,t)=>s.jsxs("div",{className:""+(t>0?"border-t border-coyote/30 pt-6":""),children:[s.jsxs("button",{onClick:()=>le(e.id),className:"flex items-center justify-between w-full text-left text-dark font-sans font-medium text-lg uppercase tracking-wide mb-4",children:[s.jsx("span",{children:e.name}),e.isExpanded?s.jsx(x,{className:"w-5 h-5"}):s.jsx(u,{className:"w-5 h-5"})]}),e.isExpanded&&s.jsx("div",{className:"space-y-2",children:e.items.map((t,a)=>{const r="brands"===e.id?t.split(" (")[0]:t,i=(()=>{switch(e.id){case"styles":return M.includes(t);case"moods":return B.includes(t);case"collections":case"origins":return W.includes(t);case"rooms":case"strengths":return H.includes(t);case"brands":return G.includes(r);case"pack-sizes":return G.includes(t);case"price-range":case"quick-ship":return Q.includes(t);default:return!1}})();return s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:s=>me(e.id,r,s.target.checked),className:"mr-3 w-4 h-4 text-dark border-coyote rounded focus:ring-dark"}),s.jsx("span",{className:"text-dark font-sans text-base",children:t})]},a)})})]},e.id))})}),J&&s.jsx("div",{className:"lg:hidden fixed inset-0 z-50 bg-creme",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("div",{className:"flex items-center justify-between mb-6",children:[s.jsx("h2",{className:"text-dark font-sans font-medium text-lg uppercase tracking-wide",children:"Filters"}),s.jsx("button",{onClick:()=>X(!1),className:"text-dark hover:text-canyon transition-colors",children:s.jsx(x,{className:"w-6 h-6"})})]}),s.jsx("div",{className:"space-y-6",children:re.map((e,t)=>s.jsxs("div",{className:""+(t>0?"border-t border-coyote/30 pt-6":""),children:[s.jsxs("button",{onClick:()=>le(e.id),className:"flex items-center justify-between w-full text-left text-dark font-sans font-medium text-lg uppercase tracking-wide mb-4",children:[s.jsx("span",{children:e.name}),e.isExpanded?s.jsx(x,{className:"w-5 h-5"}):s.jsx(u,{className:"w-5 h-5"})]}),e.isExpanded&&s.jsx("div",{className:"space-y-2",children:e.items.map((t,a)=>{const r="brands"===e.id?t.split(" (")[0]:t,i=(()=>{switch(e.id){case"styles":return M.includes(t);case"moods":return B.includes(t);case"collections":case"origins":return W.includes(t);case"rooms":case"strengths":return H.includes(t);case"brands":return G.includes(r);case"pack-sizes":return G.includes(t);case"price-range":case"quick-ship":return Q.includes(t);default:return!1}})();return s.jsxs("label",{className:"flex items-center cursor-pointer",children:[s.jsx("input",{type:"checkbox",checked:i,onChange:s=>me(e.id,r,s.target.checked),className:"mr-3 w-4 h-4 text-dark border-coyote rounded focus:ring-dark"}),s.jsx("span",{className:"text-dark font-sans text-base",children:t})]},a)})})]},e.id))})]})}),s.jsxs("div",{className:"flex-1 relative",children:[V&&s.jsx("div",{className:"absolute inset-0 bg-creme/50 backdrop-blur-sm z-10 flex items-center justify-center",children:s.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-lg flex items-center gap-3",children:[s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-dark"}),s.jsx("span",{className:"text-dark font-sans text-sm",children:"Filtering products..."})]})}),0===xe.length?s.jsxs("div",{className:"text-center py-16",children:[s.jsx(h,{className:"w-16 h-16 mx-auto mb-4 text-coyote"}),s.jsx("h3",{className:"text-2xl font-serif text-dark mb-4",children:"No products found"}),s.jsx("p",{className:"text-dark/80 mb-8",children:"We couldn't find any products matching your criteria."})]}):s.jsx("div",{className:""+("grid"===y?"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6":"space-y-4"),children:xe.map((e,t)=>s.jsx(o,{product:e,variant:"list"===y?"list":"default",onAddToCart:oe,onToggleWishlist:ae,isWishlisted:te(e.id),isLoading:se,index:t},e.id))}),he>1&&s.jsxs("div",{className:"flex justify-center items-center gap-2 mt-12",children:[s.jsx("button",{onClick:()=>N(e=>Math.max(e-1,1)),disabled:1===k,className:"px-4 py-2 border border-coyote rounded-md text-dark font-sans disabled:opacity-50 disabled:cursor-not-allowed hover:bg-creme-light transition-colors duration-300",children:"Previous"}),s.jsx("div",{className:"flex gap-1",children:[...Array(he)].map((e,t)=>{const a=t+1;return 1===a||a===he||a>=k-1&&a<=k+1?s.jsx("button",{onClick:()=>N(a),className:"w-10 h-10 rounded-md font-sans font-medium transition-colors duration-300 "+(k===a?"bg-dark text-creme-light":"border border-coyote hover:bg-creme-light text-dark"),children:a},a):a===k-2||a===k+2?s.jsx("span",{className:"w-10 h-10 flex items-center justify-center text-coyote",children:"..."},a):null})}),s.jsx("button",{onClick:()=>N(e=>Math.min(e+1,he)),disabled:k===he,className:"px-4 py-2 border border-coyote rounded-md text-dark font-sans disabled:opacity-50 disabled:cursor-not-allowed hover:bg-creme-light transition-colors duration-300",children:"Next"})]})]})]})]}),s.jsx("div",{className:"fixed bottom-6 right-6 z-50",children:s.jsx("button",{className:"w-14 h-14 bg-canyon text-creme-light rounded-full flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-110",children:s.jsx("span",{className:"text-xl font-bold",children:"?"})})})]})]})}export{p as ProductsPage};
