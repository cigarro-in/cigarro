import{r as e,j as t}from"./ui-DmSYmwlh.js";import{Y as r,u as s,n as a,a as n,s as i,t as o,H as c,p as d,Z as l}from"./index-sG1ZoleV.js";import{S as m}from"./shopping-cart-D8ThiKve.js";import"./vendor-CTYTkcnE.js";import"./supabase-CLG-Fze1.js";function u(){const{slug:u}=r(),p=s(),h=a(),[x,g]=e.useState(null),[f,b]=e.useState([]),[j,y]=e.useState(!0),[w,v]=e.useState(1),[N,_]=e.useState("name"),{addToCart:k,isLoading:S}=n(),P="/products"===h.pathname,C=new URLSearchParams(h.search).get("search")||"";e.useEffect(()=>{P?$():u&&F()},[u,P,C]);const $=async()=>{y(!0);try{let e=i.from("products").select("id, name, slug, brand, price, description, is_active, gallery_images, rating, review_count, created_at").eq("is_active",!0);C.trim()&&(e=e.or(`name.ilike.%${C}%,brand.ilike.%${C}%,description.ilike.%${C}%`));const{data:t,error:r}=await e.order("created_at",{ascending:!1});if(r)throw r;b(t||[])}catch(e){console.error("Error fetching products:",e),o.error("Failed to load products")}finally{y(!1)}},F=async()=>{if(u){y(!0);try{const{data:e,error:t}=await i.from("categories").select("\n          id,\n          name,\n          description,\n          image,\n          meta_title,\n          meta_description,\n          products:product_categories!inner(\n            order,\n            products!inner(\n              id,\n              name,\n              brand,\n              price,\n              description,\n              is_active,\n              slug,\n              gallery_images,\n              rating,\n              review_count,\n              image,\n              limited,\n              created_at\n            )\n          )\n        ").eq("slug",u).eq("products.products.is_active",!0).single();if(t){if("PGRST116"===t.code)return void p("/404");throw t}const r={id:e.id,name:e.name,description:e.description,image:e.image,meta_title:e.meta_title,meta_description:e.meta_description};g(r);const s=e.products?.map(e=>e.products).filter(Boolean)||[];b(s)}catch(e){console.error("Error fetching category:",e),o.error("Failed to load category")}finally{y(!1)}}},T=async e=>{try{await k(e,1),o.success(`${e.name} added to cart!`)}catch(t){o.error("Failed to add to cart")}},L=[...f].sort((e,t)=>{switch(N){case"price-low":return e.price-t.price;case"price-high":return t.price-e.price;case"rating":return(t.rating||0)-(e.rating||0);case"newest":return new Date(t.created_at||0).getTime()-new Date(e.created_at||0).getTime();default:return e.name.localeCompare(t.name)}}),A=L.slice(12*(w-1),12*w),E=Math.ceil(L.length/12),H=P?C?`Search Results for "${C}"`:"Premium Tobacco Products":x?.meta_title||x?.name||"Products",R=P?C?`Search results for "${C}" - Find the perfect tobacco products that match your preferences.`:"Discover our complete collection of premium cigarettes, cigars, and tobacco products from world-renowned brands.":x?.meta_description||x?.description||"Premium tobacco products";return j?t.jsx("div",{className:"main-container section",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-dark"}),t.jsx("p",{className:"text mt-4",children:"Loading premium products..."})]})}):t.jsxs(t.Fragment,{children:[t.jsxs(c,{children:[t.jsxs("title",{children:[H," - Cigarro"]}),t.jsx("meta",{name:"description",content:R})]}),t.jsxs("div",{className:"main-container section",children:[t.jsxs("div",{className:"text-center mb-16",children:[t.jsx("h1",{className:"main-title mb-6",children:H}),(x?.description||P)&&t.jsx("div",{className:"text-wrapper text-center max-w-4xl mx-auto",children:t.jsx("p",{className:"text",children:x?.description||(C?`Found ${L.length} products matching "${C}"`:"Explore our curated selection of premium tobacco products, carefully sourced from the finest growers worldwide.")})})]}),t.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-coyote/20 p-6 mb-12",children:t.jsxs("div",{className:"flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6",children:[t.jsxs("div",{className:"flex items-center gap-6",children:[t.jsxs("span",{className:"text-dark font-sans font-medium text-lg",children:[L.length," ",1===L.length?"product":"products"," found"]}),!j&&0===L.length&&t.jsx("span",{className:"text-canyon font-sans text-sm",children:"Try adjusting your search or browse all products"})]}),t.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[t.jsx("label",{className:"text-dark font-sans font-medium text-base",children:"Sort by:"}),t.jsxs("select",{value:N,onChange:e=>_(e.target.value),className:"bg-creme-light border-2 border-coyote rounded-lg px-4 py-3 text-dark font-sans text-base focus:outline-none focus:ring-2 focus:ring-canyon focus:border-canyon transition-colors min-w-[200px]",children:[t.jsx("option",{value:"name",children:"Name A-Z"}),t.jsx("option",{value:"price-low",children:"Price: Low to High"}),t.jsx("option",{value:"price-high",children:"Price: High to Low"}),t.jsx("option",{value:"rating",children:"Highest Rated"}),t.jsx("option",{value:"newest",children:"Newest First"})]})]})]})}),0===A.length?t.jsxs("div",{className:"text-center py-16",children:[t.jsx(m,{className:"w-16 h-16 mx-auto mb-4 text-coyote"}),t.jsx("h3",{className:"text-2xl font-serif text-dark mb-4",children:"No products found"}),t.jsx("p",{className:"text-dark/80 mb-8",children:"We couldn't find any products in this category."}),t.jsx(d,{to:"/products",className:"inline-block bg-dark text-creme-light px-6 py-3 rounded-full font-medium hover:bg-creme-light hover:text-dark transition-colors duration-300 uppercase tracking-wide text-sm",children:"Browse All Products"})]}):t.jsx("div",{className:"space-y-6",children:A.map((e,r)=>t.jsx(l,{product:e,variant:"list",onAddToCart:T,isLoading:S,index:r},e.id))}),E>1&&t.jsxs("div",{className:"flex justify-center items-center gap-2",children:[t.jsx("button",{onClick:()=>v(e=>Math.max(e-1,1)),disabled:1===w,className:"px-4 py-2 border border-coyote rounded-md text font-sans disabled:opacity-50 disabled:cursor-not-allowed hover:bg-creme-light transition-colors duration-300",children:"Previous"}),t.jsx("div",{className:"flex gap-1",children:[...Array(E)].map((e,r)=>{const s=r+1;return 1===s||s===E||s>=w-1&&s<=w+1?t.jsx("button",{onClick:()=>v(s),className:"w-10 h-10 rounded-md font-sans font-medium transition-colors duration-300 "+(w===s?"bg-dark text-creme-light":"border border-coyote hover:bg-creme-light"),children:s},s):s===w-2||s===w+2?t.jsx("span",{className:"w-10 h-10 flex items-center justify-center text-coyote",children:"..."},s):null})}),t.jsx("button",{onClick:()=>v(e=>Math.min(e+1,E)),disabled:w===E,className:"px-4 py-2 border border-coyote rounded-md text font-sans disabled:opacity-50 disabled:cursor-not-allowed hover:bg-creme-light transition-colors duration-300",children:"Next"})]})]})]})}export{u as CategoryPage};
