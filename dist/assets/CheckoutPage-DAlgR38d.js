const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browser-BjRqf1-l.js","assets/index-sG1ZoleV.js","assets/ui-DmSYmwlh.js","assets/vendor-CTYTkcnE.js","assets/supabase-CLG-Fze1.js","assets/index-Be-tarQr.css"])))=>i.map(i=>d[i]);
import{_ as e}from"./supabase-CLG-Fze1.js";import{r as s,j as a}from"./ui-DmSYmwlh.js";import{c as r,s as t,u as n,a as i,b as c,L as l,B as d,A as o,C as m,d as u,f as x,P as h,e as p,g as j,I as g,E as f,t as N,M as v,T as b,h as y,v as _,i as w,j as C,k,l as S,m as P}from"./index-sG1ZoleV.js";import{S as $,C as F,a as D,b as I,c as A}from"./separator-C5Dcbw9Z.js";import{M as T,S as q,a as E,b as L,c as M,d as U}from"./select-De3tEF3x.js";import{S as z,M as O,R,C as V,Q as B}from"./browser-BjRqf1-l.js";import{T as G}from"./truck-BHGA4bM_.js";import{P as Q}from"./plus-Bq58mKy_.js";import{A as H}from"./arrow-left-BDiTJN5X.js";import"./vendor-CTYTkcnE.js";import"./chevron-up-BjPB7NKs.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=r("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),X=r("message-square",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),Y=r("navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]),K=r("zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),J=(e,s,a)=>{if(e.min_cart_value&&a<e.min_cart_value)return!1;switch(e.applicable_to){case"all":return!0;case"products":return s.some(s=>!s.combo_id&&e.product_ids?.includes(s.id));case"combos":return s.some(s=>s.combo_id&&e.combo_ids?.includes(s.combo_id));case"variants":return s.some(s=>s.variant_id&&e.variant_ids?.includes(s.variant_id));default:return!1}},Z=(e,s)=>{let a=0;switch(e.type){case"percentage":a=s*e.value/100;break;case"fixed_amount":case"cart_value":a=e.value}return e.max_discount_amount&&a>e.max_discount_amount&&(a=e.max_discount_amount),Math.min(a,s)};function ee(){const r=n(),{items:ee,totalPrice:se,clearCart:ae,getCartItemPrice:re}=i(),{user:te,isLoading:ne}=c(),[ie,ce]=s.useState(!1),[le,de]=s.useState(1),[oe,me]=s.useState(!1),[ue,xe]=s.useState(!1),[he,pe]=s.useState(null),[je,ge]=s.useState([]),[fe,Ne]=s.useState(""),[ve,be]=s.useState(!1),[ye,_e]=s.useState({}),[we,Ce]=s.useState(""),[ke,Se]=s.useState(null),[Pe,$e]=s.useState(!1),[Fe,De]=s.useState(""),[Ie,Ae]=s.useState(""),[Te,qe]=s.useState(""),[Ee,Le]=s.useState(!1),[Me,Ue]=s.useState("+91"),[ze,Oe]=s.useState(!1),[Re,Ve]=s.useState(!0),[Be,Ge]=s.useState(null),Qe=s.useRef(!1),[He,We]=s.useState(""),[Xe,Ye]=s.useState(null),[Ke,Je]=s.useState(""),[Ze,es]=s.useState(!1),[ss,as]=s.useState({fullName:te?.name||"",email:te?.email||"",phone:"",address:"",pincode:"",city:"",state:"",country:"India",paymentMethod:"upi",shippingMethod:"standard"}),[rs]=s.useState(()=>{const e=(Math.floor(99*Math.random())+1)/100;return Math.max(.01,Math.min(.99,e))}),ts=()=>{ce(!1)};if(s.useEffect(()=>{if(!te&&!ne){const e=setTimeout(()=>{ce(!0)},100);return()=>clearTimeout(e)}},[te,ne]),s.useEffect(()=>{te&&!Qe.current?(ms(),os(),as(e=>({...e,fullName:te.name||e.fullName,email:te.email||e.email})),Qe.current=!0):te||(Qe.current=!1)},[te]),s.useEffect(()=>()=>{Be&&clearTimeout(Be)},[Be]),s.useEffect(()=>{Ae(ss.email),qe(ss.phone)},[ss.email,ss.phone]),ne)return a.jsx("div",{className:"min-h-screen bg-creme flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-dark mx-auto mb-4"}),a.jsx("p",{className:"text-muted-foreground",children:"Loading..."})]})});if(!te)return a.jsxs("div",{className:"min-h-screen bg-creme flex items-center justify-center p-4",children:[a.jsxs("div",{className:"text-center max-w-md w-full",children:[a.jsx(l,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),a.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Authentication Required"}),a.jsx("p",{className:"text-muted-foreground mb-6",children:"Please sign in or create an account to proceed with checkout"}),a.jsxs("div",{className:"space-y-3",children:[a.jsx(d,{onClick:()=>ce(!0),className:"w-full",size:"lg",children:"Sign In / Sign Up"}),a.jsx(d,{variant:"outline",onClick:()=>r("/products"),className:"w-full",size:"lg",children:"I'm Just Browsing"})]}),a.jsx("p",{className:"text-sm text-muted-foreground mt-4",children:"You can continue shopping and sign in when you're ready to checkout"})]}),a.jsx(o,{open:ie,onOpenChange:ce,onAuthSuccess:ts,context:"checkout"})]});const ns={standard:{name:"Standard Shipping",price:0,time:"5-7 business days",icon:G},express:{name:"Express Shipping",price:150,time:"2-3 business days",icon:m},overnight:{name:"Overnight Delivery",price:300,time:"Next business day",icon:K}},is=ns[ss.shippingMethod].price,cs=se+is,ls=rs+(Xe?.discount_amount||0),ds=cs-ls,os=async()=>{try{const s=`TXN${Date.now().toString().slice(-8)}`,a=await e(()=>import("./browser-BjRqf1-l.js").then(e=>e.b),__vite__mapDeps([0,1,2,3,4,5])),r=`upi://pay?pa=hrejuh@upi&pn=Cigarro&am=${ds}&tid=${s}&tn=${s}`,t=await a.toDataURL(r,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});Ce(t)}catch(s){console.error("Error preloading QR code:",s)}},ms=async(e=!1)=>{if(!te)return;const{data:s,error:a}=await t.from("saved_addresses").select("*").eq("user_id",te.id).order("is_default",{ascending:!1}).order("created_at",{ascending:!1});if(a)console.error("Error loading saved addresses:",a);else if(ge(s||[]),!e){const e=s?.find(e=>e.is_default);!e||Pe||ss.address||(as(s=>({...s,fullName:e.full_name||s.fullName,phone:e.phone?.replace(/^\+91\s*/,"")||s.phone,address:e.address,city:e.city,state:e.state,pincode:e.pincode,country:e.country})),Ve(!1),$e(!0))}},us=(e,s)=>{as(a=>({...a,[e]:s})),ye[e]&&_e(s=>({...s,[e]:""})),Pe||$e(!0)},xs=()=>{const e=_(ss,{fullName:e=>w(e,"Full name"),email:e=>P(e),phone:e=>S(e,Me),address:e=>k(e),pincode:e=>C(e),city:e=>w(e,"City"),state:e=>w(e,"State")});return _e(e.errors),e.isValid&&as(s=>({...s,...e.sanitizedData})),e.isValid},hs=async()=>{if(!te)return!1;const{data:e,error:s}=await t.from("saved_addresses").select("id").eq("user_id",te.id).eq("address",ss.address).eq("pincode",ss.pincode).limit(1);return s?(console.error("Error checking for duplicates:",s),!1):e&&e.length>0},ps=async()=>{try{const e=`TXN${Date.now().toString().slice(-8)}`,s=`upi://pay?pa=hrejuh@upi&pn=Cigarro&am=${ds}&tid=${e}&tn=${e}`,a=await B.toDataURL(s,{width:256,margin:2,color:{dark:"#000000",light:"#FFFFFF"}});De(a)}catch(e){console.error("Error generating QR code:",e)}},js=async e=>{if(!("email"===e?Ie:Te))return void N.error("Please enter "+("email"===e?"email address":"phone number"));const s=`TXN${Date.now().toString().slice(-8)}`,a=`upi://pay?pa=hrejuh@upi&pn=Cigarro&am=${ds}&tid=${s}&tn=${s}`;try{await navigator.clipboard.writeText(a),N.success(`Payment link copied to clipboard! Share it via ${e}.`)}catch(r){console.error("Failed to copy link:",r),N.error("Failed to copy payment link")}};return ue?a.jsx("div",{className:"min-h-screen bg-background py-12",children:a.jsx("div",{className:"max-w-2xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"mx-auto w-16 h-16 bg-gradient-to-r from-green-400 to-green-600 rounded-full flex items-center justify-center mb-6",children:a.jsx(u,{className:"w-8 h-8 text-white"})}),a.jsx("h1",{className:"font-serif-premium text-3xl text-foreground mb-4",children:"Order Confirmed"}),a.jsx("p",{className:"font-sans-premium text-muted-foreground mb-8",children:"Thank you for your purchase. Your order has been confirmed and will be shipped shortly."}),a.jsxs("div",{className:"glass-card p-6 mb-8",children:[a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Order Number"}),a.jsxs("span",{className:"font-sans-premium text-foreground",children:["#",he?.display_order_id||"Loading..."]})]}),a.jsx($,{className:"my-4"}),a.jsxs("div",{className:"flex items-center justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Total Paid"}),a.jsx("span",{className:"font-serif-premium text-xl text-accent",children:x(he?.total)})]})]}),a.jsx(d,{onClick:()=>r("/"),className:"bg-accent text-accent-foreground hover:bg-accent/90",children:"Continue Shopping"})]})})}):a.jsx("div",{className:"min-h-screen bg-background py-8",children:a.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:a.jsxs("div",{className:"flex gap-16",children:[a.jsx("div",{className:"w-32 flex-shrink-0 pl-2",children:a.jsx("div",{className:"fixed left-4 top-1/2 transform -translate-y-1/2 z-10",children:a.jsx("div",{className:"flex flex-col items-center space-y-8",children:[{step:1,label:"Shipping",icon:T},{step:2,label:"Review",icon:h},{step:3,label:"Payment",icon:W}].map(({step:e,label:s,icon:r},t)=>a.jsxs("div",{className:"flex flex-col items-center",children:[a.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-300 "+(e<=le?"bg-accent border-accent text-accent-foreground shadow-lg":"border-border text-muted-foreground bg-background"),children:a.jsx(r,{className:"w-5 h-5"})}),a.jsxs("div",{className:"mt-2 text-center",children:[a.jsx("div",{className:"font-sans-premium text-sm font-medium transition-colors "+(e<=le?"text-foreground":"text-muted-foreground"),children:s}),e<le&&a.jsx("div",{className:"text-xs text-accent font-medium mt-1",children:"✓ Done"}),e===le&&a.jsx("div",{className:"text-xs text-accent font-medium mt-1 animate-pulse",children:"● Now"})]}),t<2&&a.jsx("div",{className:"mt-4 mb-4",children:a.jsx("div",{className:"w-0.5 h-12 rounded-full transition-all duration-300 "+(e<le?"bg-accent shadow-sm":"bg-border")})})]},e))})})}),a.jsx("div",{className:"flex-1",children:a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[a.jsxs("div",{className:"lg:col-span-2",children:[1===le&&a.jsxs(F,{className:"glass-card border-border/20",children:[a.jsx(D,{children:a.jsxs(I,{className:"flex items-center space-x-2 font-serif-premium",children:[a.jsx(T,{className:"w-5 h-5 text-accent"}),a.jsx("span",{children:"Shipping Information"})]})}),a.jsxs(A,{className:"space-y-6",children:[je.length>0&&!ze&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(p,{className:"font-sans-premium",children:"Delivery Address"}),a.jsx(d,{variant:"outline",size:"sm",onClick:()=>{Oe(!0),Ve(!0)},className:"text-xs",children:"Change Address"})]}),a.jsx("div",{className:"p-4 rounded-lg border border-accent bg-accent/10 mb-4",children:a.jsx("div",{className:"flex items-start justify-between",children:a.jsxs("div",{className:"flex-1",children:[a.jsxs("p",{className:"font-sans-premium font-medium text-sm",children:[ss.fullName,je.find(e=>e.full_name===ss.fullName&&e.address===ss.address)?.is_default&&a.jsx(j,{variant:"secondary",className:"ml-2 text-xs",children:"Primary"})]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:ss.address}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[ss.city,", ",ss.state," - ",ss.pincode]}),a.jsx("p",{className:"text-xs text-muted-foreground",children:ss.phone})]})})}),a.jsx($,{className:"my-4"})]}),ze&&a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx(p,{className:"font-sans-premium",children:"Choose Address"}),a.jsx(d,{variant:"outline",size:"sm",onClick:()=>Oe(!1),className:"text-xs",children:"Cancel"})]}),a.jsxs("div",{className:"grid grid-cols-1 gap-3 mb-4",children:[a.jsxs("div",{onClick:()=>{Ve(!0),as(e=>({...e,address:"",city:"",state:"",pincode:"",country:"India"}))},className:"p-4 rounded-lg border cursor-pointer transition-colors "+(Re?"border-accent bg-accent/10":"border-border/20 hover:border-accent/50"),children:[a.jsx("p",{className:"font-sans-premium font-medium text-sm",children:"+ Add New Address"}),a.jsx("p",{className:"text-xs text-muted-foreground",children:"Enter a new delivery address"})]}),je.map(e=>a.jsx("div",{className:"p-4 rounded-lg border transition-colors "+(fe===e.id?"border-accent bg-accent/10":"border-border/20 hover:border-accent/50"),children:a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex items-start justify-between",children:[a.jsxs("div",{className:"flex-1",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("p",{className:"font-sans-premium font-medium text-sm",children:e.full_name}),e.is_default&&a.jsx(j,{variant:"secondary",className:"text-xs",children:"Primary"})]}),a.jsx("p",{className:"text-xs text-muted-foreground line-clamp-2",children:e.address}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:[e.city,", ",e.state]}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["PIN: ",e.pincode]})]}),e.latitude&&e.longitude&&a.jsx(Y,{className:"w-3 h-3 text-accent flex-shrink-0"})]}),a.jsxs("div",{className:"flex gap-2 pt-2",children:[a.jsx(d,{size:"sm",variant:"outline",onClick:()=>(e=>{const s=je.find(s=>s.id===e);s&&(as(e=>({...e,fullName:s.full_name,email:e.email,phone:s.phone?.replace(/^\+91\s*/,"")||"",address:s.address,city:s.city,state:s.state,pincode:s.pincode,country:s.country})),Ne(e),Ve(!1),Oe(!1))})(e.id),className:"flex-1 text-xs h-7",children:"Use This"}),!e.is_default&&a.jsx(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(te)try{await t.from("saved_addresses").update({is_default:!1}).eq("user_id",te.id),await t.from("saved_addresses").update({is_default:!0}).eq("id",e).eq("user_id",te.id),await ms(!0),N.success("Primary address updated")}catch(s){console.error("Error setting primary address:",s),N.error("Failed to set primary address")}})(e.id),className:"text-xs h-7 px-2",children:"Set Primary"}),a.jsx(d,{size:"sm",variant:"outline",onClick:()=>(async e=>{if(!te)return;const{error:s}=await t.from("saved_addresses").delete().eq("id",e).eq("user_id",te.id);s?N.error("Failed to delete address"):(N.success("Address deleted successfully"),ms(!0),fe===e&&Ne(""))})(e.id),className:"text-xs h-7 px-2 text-red-600 hover:text-red-700",children:"Delete"})]})]})},e.id))]}),a.jsx($,{className:"my-4"})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(d,{type:"button",variant:"outline",onClick:()=>{if(be(!0),!navigator.geolocation)return N.error("Geolocation is not supported by this browser"),void be(!1);navigator.geolocation.getCurrentPosition(async e=>{try{const{latitude:s,longitude:a}=e.coords;Se({lat:s,lng:a});const r=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s}&lon=${a}&addressdetails=1`),t=await r.json();if(t&&t.address){const e=t.address,s=t.display_name,a=e.house_number||"",r=e.road||e.street||"",n=e.suburb||e.neighbourhood||"",i=e.city||e.town||e.village||e.municipality||"",c=e.state||"",l=e.postcode||"",d=[a,r,n].filter(Boolean).join(", ");as(e=>({...e,address:d||s,city:i,state:c,pincode:l})),_e(e=>({...e,address:"",city:"",state:"",pincode:""})),N.success("Location detected and address filled!")}else N.error("Unable to get address from location")}catch(s){console.error("Error getting address from coordinates:",s),N.error("Unable to get address from location")}be(!1)},e=>{console.log("Geolocation error (handled gracefully):",e);let s="Unable to get your location";1===e.code?s="Location permission denied. Please enable location access in your browser settings and try again.":2===e.code?s="Location service unavailable. Please check your internet connection and try again.":3===e.code&&(s="Location request timed out. Please try again with a stronger internet connection."),N.info(s),be(!1)},{enableHighAccuracy:!0,timeout:15e3,maximumAge:6e4})},disabled:ve,className:"flex-1",children:[a.jsx(Y,{className:"w-4 h-4 mr-2"}),ve?"Getting Location...":"Use Current Location"]}),a.jsxs(d,{type:"button",variant:"outline",onClick:async()=>{if(!te||!xs())return;if(await hs())return void N.info("This address is already saved");const e=ss.phone.startsWith("+")?ss.phone:`${Me} ${ss.phone}`,{error:s}=await t.from("saved_addresses").insert({user_id:te.id,label:"Home",full_name:ss.fullName,phone:e,address:ss.address,user_provided_address:ss.address,city:ss.city,state:ss.state,pincode:ss.pincode,country:ss.country,latitude:ke?.lat,longitude:ke?.lng,is_default:!1});s?N.error("Failed to save address"):(N.success("Address saved successfully"),ms(!0))},className:"flex-none",children:[a.jsx(Q,{className:"w-4 h-4 mr-2"}),"Save Address"]})]}),(0===je.length||ze||Re)&&a.jsxs("div",{children:[a.jsx(p,{htmlFor:"fullName",className:"font-sans-premium",children:"Full Name *"}),a.jsx(g,{id:"fullName",value:ss.fullName,onChange:e=>us("fullName",e.target.value),className:"mt-1 bg-input-background "+(ye.fullName?"border-red-500":"border-border/20")}),ye.fullName&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.fullName})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{children:[a.jsx(p,{htmlFor:"email",className:"font-sans-premium",children:"Email Address *"}),a.jsx(g,{id:"email",type:"email",value:ss.email,onChange:e=>us("email",e.target.value),placeholder:"your@email.com",className:"mt-1 bg-input-background "+(ye.email?"border-red-500":"border-border/20")}),ye.email&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.email})]}),a.jsxs("div",{children:[a.jsx(p,{htmlFor:"phone",className:"font-sans-premium",children:"Phone Number *"}),a.jsxs("div",{className:"flex mt-1",children:[a.jsxs(q,{value:Me,onValueChange:Ue,children:[a.jsx(E,{className:"w-24 rounded-r-none bg-input-background border-r-0 "+(ye.phone?"border-red-500":"border-border/20"),children:a.jsx(L,{})}),a.jsxs(M,{className:"bg-background border border-border shadow-lg max-h-60 overflow-y-auto",children:[a.jsx(U,{value:"+971",children:"🇦🇪 +971"}),a.jsx(U,{value:"+61",children:"🇦🇺 +61"}),a.jsx(U,{value:"+880",children:"🇧🇩 +880"}),a.jsx(U,{value:"+55",children:"🇧🇷 +55"}),a.jsx(U,{value:"+1",children:"🇨🇦 +1"}),a.jsx(U,{value:"+86",children:"🇨🇳 +86"}),a.jsx(U,{value:"+49",children:"🇩🇪 +49"}),a.jsx(U,{value:"+20",children:"🇪🇬 +20"}),a.jsx(U,{value:"+33",children:"🇫🇷 +33"}),a.jsx(U,{value:"+44",children:"🇬🇧 +44"}),a.jsx(U,{value:"+91",children:"🇮🇳 +91"}),a.jsx(U,{value:"+62",children:"🇮🇩 +62"}),a.jsx(U,{value:"+98",children:"🇮🇷 +98"}),a.jsx(U,{value:"+39",children:"🇮🇹 +39"}),a.jsx(U,{value:"+81",children:"🇯🇵 +81"}),a.jsx(U,{value:"+60",children:"🇲🇾 +60"}),a.jsx(U,{value:"+52",children:"🇲🇽 +52"}),a.jsx(U,{value:"+31",children:"🇳🇱 +31"}),a.jsx(U,{value:"+64",children:"🇳🇿 +64"}),a.jsx(U,{value:"+92",children:"🇵🇰 +92"}),a.jsx(U,{value:"+63",children:"🇵🇭 +63"}),a.jsx(U,{value:"+48",children:"🇵🇱 +48"}),a.jsx(U,{value:"+7",children:"🇷🇺 +7"}),a.jsx(U,{value:"+966",children:"🇸🇦 +966"}),a.jsx(U,{value:"+65",children:"🇸🇬 +65"}),a.jsx(U,{value:"+27",children:"🇿🇦 +27"}),a.jsx(U,{value:"+82",children:"🇰🇷 +82"}),a.jsx(U,{value:"+34",children:"🇪🇸 +34"}),a.jsx(U,{value:"+46",children:"🇸🇪 +46"}),a.jsx(U,{value:"+41",children:"🇨🇭 +41"}),a.jsx(U,{value:"+66",children:"🇹🇭 +66"}),a.jsx(U,{value:"+90",children:"🇹🇷 +90"}),a.jsx(U,{value:"+380",children:"🇺🇦 +380"}),a.jsx(U,{value:"+1",children:"🇺🇸 +1"}),a.jsx(U,{value:"+84",children:"🇻🇳 +84"})]})]}),a.jsx(g,{id:"phone",type:"tel",value:ss.phone,onChange:e=>us("phone",e.target.value),placeholder:"+91"===Me?"10-digit mobile number":"Mobile number",className:"flex-1 rounded-l-none bg-input-background "+(ye.phone?"border-red-500":"border-border/20")})]}),ye.phone&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.phone})]})]}),a.jsxs("div",{children:[a.jsx(p,{htmlFor:"address",className:"font-sans-premium",children:"Address *"}),a.jsx(g,{id:"address",value:ss.address,onChange:e=>us("address",e.target.value),placeholder:"House/Flat No., Street, Area",className:"mt-1 bg-input-background "+(ye.address?"border-red-500":"border-border/20")}),ye.address&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.address})]}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[a.jsxs("div",{children:[a.jsx(p,{htmlFor:"pincode",className:"font-sans-premium",children:"PIN Code *"}),a.jsx(g,{id:"pincode",value:ss.pincode,onChange:e=>{us("pincode",e.target.value),Be&&clearTimeout(Be);const s=setTimeout(()=>{(async e=>{if(6===e.length)try{const{data:s,error:a}=await t.from("pincode_lookup").select("*").eq("pincode",e).single();if(a)return console.log("PIN code not found in database:",a.message),void _e(e=>({...e,pincode:"This PIN code is not servicable"}));s?(as(e=>({...e,city:s.city,state:s.state,country:s.country})),"+91"!==Me&&Ue("+91"),_e(e=>({...e,city:"",state:"",pincode:""})),s.shipping_method&&"standard"!==s.shipping_method&&as(e=>({...e,shippingMethod:s.shipping_method})),N.success(`Location found: ${s.city}, ${s.state}`)):(console.log("PIN code not found or not servicable"),_e(e=>({...e,pincode:"This PIN code is not servicable"})))}catch(s){console.error("Error fetching location from pincode:",s),_e(e=>({...e,pincode:"Error checking PIN code"}))}})(e.target.value)},500);Ge(s)},placeholder:"6 digit PIN code",maxLength:6,className:"mt-1 bg-input-background "+(ye.pincode?"border-red-500":"border-border/20")}),ye.pincode&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.pincode})]}),a.jsxs("div",{children:[a.jsx(p,{htmlFor:"city",className:"font-sans-premium",children:"City *"}),a.jsx(g,{id:"city",value:ss.city,onChange:e=>us("city",e.target.value),className:"mt-1 bg-input-background "+(ye.city?"border-red-500":"border-border/20")}),ye.city&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.city})]}),a.jsxs("div",{children:[a.jsx(p,{htmlFor:"state",className:"font-sans-premium",children:"State *"}),a.jsxs(q,{value:ss.state,onValueChange:e=>us("state",e),children:[a.jsx(E,{className:"mt-1 bg-input-background "+(ye.state?"border-red-500":"border-border/20"),children:a.jsx(L,{placeholder:"Select state"})}),a.jsxs(M,{className:"bg-background border border-border shadow-lg max-h-60 overflow-y-auto",children:[a.jsx(U,{value:"Andhra Pradesh",children:"Andhra Pradesh"}),a.jsx(U,{value:"Delhi",children:"Delhi"}),a.jsx(U,{value:"Goa",children:"Goa"}),a.jsx(U,{value:"Gujarat",children:"Gujarat"}),a.jsx(U,{value:"Haryana",children:"Haryana"}),a.jsx(U,{value:"Karnataka",children:"Karnataka"}),a.jsx(U,{value:"Kerala",children:"Kerala"}),a.jsx(U,{value:"Maharashtra",children:"Maharashtra"}),a.jsx(U,{value:"Punjab",children:"Punjab"}),a.jsx(U,{value:"Rajasthan",children:"Rajasthan"}),a.jsx(U,{value:"Tamil Nadu",children:"Tamil Nadu"}),a.jsx(U,{value:"Telangana",children:"Telangana"}),a.jsx(U,{value:"Uttar Pradesh",children:"Uttar Pradesh"}),a.jsx(U,{value:"West Bengal",children:"West Bengal"})]})]}),ye.state&&a.jsx("p",{className:"text-red-500 text-sm mt-1",children:ye.state})]})]}),a.jsxs("div",{children:[a.jsx(p,{className:"font-sans-premium mb-2 block",children:"Shipping Method *"}),a.jsx("div",{className:"space-y-2",children:Object.entries(ns).map(([e,s])=>{const r=s.icon;return a.jsx("div",{onClick:()=>us("shippingMethod",e),className:"p-3 rounded-lg border cursor-pointer transition-colors "+(ss.shippingMethod===e?"border-accent bg-accent/10":"border-border/20 hover:border-accent/50"),children:a.jsxs("div",{className:"flex items-center space-x-3",children:[a.jsx(r,{className:"w-4 h-4 text-accent"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-sans-premium font-medium text-sm",children:s.name}),a.jsx("p",{className:"text-xs text-muted-foreground",children:s.time})]}),a.jsx("span",{className:"font-serif-premium text-sm text-accent",children:0===s.price?"Free":x(s.price)})]})},e)})})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(d,{variant:"outline",onClick:()=>r(-1),className:"flex items-center gap-2",children:[a.jsx(H,{className:"w-4 h-4"}),"Back"]}),a.jsx(d,{onClick:()=>{xs()&&de(2)},className:"flex-1 bg-accent text-accent-foreground hover:bg-accent/90",children:"Continue to Review"})]})]})]}),2===le&&a.jsxs(F,{className:"glass-card border-border/20",children:[a.jsx(D,{children:a.jsxs(I,{className:"flex items-center space-x-2 font-serif-premium",children:[a.jsx(h,{className:"w-5 h-5 text-accent"}),a.jsx("span",{children:"Review Your Order"})]})}),a.jsxs(A,{className:"space-y-6",children:[a.jsx("div",{className:"space-y-4",children:ee.map((e,s)=>{const r=re(e),t=`${e.id}-${e.variant_id||"base"}-${e.combo_id||"none"}-${s}`;return a.jsxs("div",{className:"flex items-center space-x-4 p-4 border border-border/20 rounded-lg",children:[a.jsx("img",{src:e.gallery_images?.[0]||e.image,alt:e.name,className:"w-16 h-16 object-cover rounded"}),a.jsxs("div",{className:"flex-1",children:[a.jsx("h3",{className:"font-serif-premium text-foreground",children:e.name}),a.jsx("p",{className:"text-sm text-muted-foreground",children:e.brand}),e.variant_name&&a.jsx("div",{className:"flex items-center gap-2 mt-1",children:a.jsxs(j,{variant:"secondary",className:"text-xs",children:[a.jsx(h,{className:"w-3 h-3 mr-1"}),e.variant_name]})}),e.combo_name&&a.jsx("div",{className:"flex items-center gap-2 mt-1",children:a.jsxs(j,{variant:"default",className:"text-xs bg-accent text-accent-foreground",children:[a.jsx(f,{className:"w-3 h-3 mr-1"}),"Combo Pack"]})}),a.jsxs("p",{className:"text-sm text-muted-foreground",children:["Qty: ",e.quantity]})]}),a.jsx("span",{className:"font-serif-premium text-accent",children:x(r*e.quantity)})]},t)})}),a.jsxs("div",{className:"p-4 bg-accent/10 rounded-lg border border-accent/20",children:[a.jsx("h4",{className:"font-sans-premium font-medium text-foreground mb-3",children:"Shipping Details"}),a.jsxs("div",{className:"space-y-1 text-sm",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Name:"})," ",ss.fullName]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Phone:"})," ",ss.phone]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Address:"})," ",ss.address]}),a.jsxs("p",{children:[a.jsx("strong",{children:"City:"})," ",ss.city,", ",ss.state," - ",ss.pincode]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Shipping Method:"})," ",ns[ss.shippingMethod].name]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(d,{variant:"outline",onClick:()=>de(1),className:"flex items-center gap-2",children:[a.jsx(H,{className:"w-4 h-4"}),"Back"]}),a.jsx(d,{onClick:()=>(async e=>{2===le&&await ps(),de(e)})(3),className:"flex-1 bg-accent text-accent-foreground hover:bg-accent/90",children:"Proceed to Payment"})]})]})]}),3===le&&a.jsxs(F,{className:"glass-card border-border/20",children:[a.jsx(D,{children:a.jsxs(I,{className:"flex items-center space-x-2 font-serif-premium",children:[a.jsx(W,{className:"w-5 h-5 text-accent"}),a.jsx("span",{children:"UPI Payment"})]})}),a.jsxs(A,{className:"space-y-6",children:[a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[a.jsxs(F,{className:"border-border/20",children:[a.jsx(D,{className:"pb-3",children:a.jsxs(I,{className:"flex items-center space-x-2 text-base",children:[a.jsx(z,{className:"w-4 h-4 text-accent"}),a.jsx("span",{children:"Pay with UPI App"})]})}),a.jsxs(A,{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Click to open your UPI app and complete payment."}),a.jsxs(d,{onClick:()=>{const e=`TXN${Date.now().toString().slice(-8)}`,s=`upi://pay?pa=hrejuh@upi&pn=Cigarro&am=${ds}&tid=${e}&tn=${e}`;window.location.href=s},className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",children:[a.jsx(z,{className:"w-4 h-4 mr-2"}),"Open UPI App"]}),a.jsx("div",{className:"text-xs text-muted-foreground text-center",children:"Works with Google Pay, PhonePe, Paytm"})]})]}),a.jsxs(F,{className:"border-border/20",children:[a.jsx(D,{className:"pb-3",children:a.jsxs(I,{className:"flex items-center space-x-2 text-base",children:[a.jsx(O,{className:"w-4 h-4 text-accent"}),a.jsx("span",{children:"Scan QR Code"})]})}),a.jsxs(A,{className:"space-y-3",children:[a.jsx("p",{className:"text-sm text-muted-foreground",children:"Scan with any UPI app on your phone."}),a.jsx("div",{className:"flex justify-center",children:Fe?a.jsx("div",{className:"p-3 bg-white rounded-lg border",children:a.jsx("img",{src:Fe,alt:"UPI Payment QR Code",className:"w-32 h-32"})}):a.jsx("div",{className:"w-32 h-32 bg-muted rounded-lg flex items-center justify-center",children:a.jsx(R,{className:"w-6 h-6 animate-spin text-muted-foreground"})})}),a.jsxs(d,{variant:"outline",onClick:()=>{const e=`TXN${Date.now().toString().slice(-8)}`,s=`upi://pay?pa=hrejuh@upi&pn=Cigarro&am=${ds}&tid=${e}&tn=${e}`;navigator.clipboard.writeText(s),N.success("UPI link copied to clipboard")},className:"w-full",children:[a.jsx(V,{className:"w-4 h-4 mr-2"}),"Copy UPI Link"]})]})]})]}),a.jsxs("div",{className:"bg-muted/20 p-4 rounded-lg border border-border/20",children:[a.jsx("h4",{className:"font-sans-premium font-medium text-foreground mb-3",children:"Send Payment Link"}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsxs("div",{className:"space-y-2",children:[a.jsx(p,{className:"text-sm",children:"Email Address"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(g,{type:"email",placeholder:ss.fullName?`${ss.fullName.toLowerCase().replace(" ",".")}@email.com`:"Enter email",value:Ie,onChange:e=>Ae(e.target.value),className:"flex-1"}),a.jsx(d,{variant:"outline",size:"sm",onClick:()=>js("email"),children:a.jsx(v,{className:"w-4 h-4"})})]})]}),a.jsxs("div",{className:"space-y-2",children:[a.jsx(p,{className:"text-sm",children:"Phone Number"}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(g,{type:"tel",placeholder:ss.phone||"Enter phone number",value:Te,onChange:e=>qe(e.target.value),className:"flex-1"}),a.jsx(d,{variant:"outline",size:"sm",onClick:()=>js("sms"),children:a.jsx(X,{className:"w-4 h-4"})})]})]})]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsxs(d,{variant:"outline",onClick:()=>de(2),className:"flex items-center gap-2",children:[a.jsx(H,{className:"w-4 h-4"}),"Back"]}),a.jsx(d,{onClick:async()=>{if(te){console.log("Starting payment confirmation..."),Le(!0);try{const e=`TXN${Date.now().toString().slice(-8)}`;console.log("Generated transaction ID:",e);const s={user_id:te.id,status:"placed",subtotal:se,tax:0,shipping:is,total:ds,discount:ls,discount_id:Xe?.discount_id||null,discount_code:Xe?.discount_code||null,payment_method:"UPI",payment_confirmed:!0,payment_confirmed_at:(new Date).toISOString(),payment_verified:"NO",transaction_id:e,shipping_name:ss.fullName,shipping_address:ss.address,shipping_city:ss.city,shipping_state:ss.state,shipping_zip_code:ss.pincode,shipping_country:ss.country,shipping_phone:`${Me} ${ss.phone}`,estimated_delivery:new Date(Date.now()+6048e5).toISOString(),payment_link_email:Ie||null,payment_link_phone:Te||null};console.log("Order data:",s);const{data:a,error:n}=await t.from("orders").insert(s).select().single();if(n)throw n;const i=ee.map(e=>({order_id:a.id,product_id:e.id,product_name:e.name,product_brand:e.brand,product_price:re(e),product_image:e.gallery_images?.[0]||e.image,quantity:e.quantity,variant_id:e.variant_id,variant_name:e.variant_name,combo_id:e.combo_id,combo_name:e.combo_name})),{error:c}=await t.from("order_items").insert(i);if(c)throw c;Re&&te&&await(async()=>{if(!te)return;if(!(await hs()))try{const e=ss.phone.startsWith("+")?ss.phone:`${Me} ${ss.phone}`,{error:s}=await t.from("saved_addresses").insert({user_id:te.id,label:"Order Address",full_name:ss.fullName,phone:e,address:ss.address,user_provided_address:ss.address,city:ss.city,state:ss.state,pincode:ss.pincode,country:ss.country,latitude:ke?.lat,longitude:ke?.lng,is_default:0===je.length});s||console.log("Address saved successfully on order completion")}catch(e){console.error("Error saving address on order success:",e)}})(),await ae(),pe(a),xe(!0),N.success(`Order #${a.display_order_id} confirmed! Your order is now being processed.`),setTimeout(()=>{r("/orders")},5e3)}catch(e){console.error("Failed to process order:",e),N.error("Failed to process order. Please contact support.")}finally{Le(!1)}}else N.error("Please log in to complete your order")},disabled:Ee,className:"flex-1 bg-green-600 text-white hover:bg-green-700",children:Ee?a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(R,{className:"w-4 h-4 animate-spin"}),a.jsx("span",{children:"Confirming..."})]}):a.jsxs(a.Fragment,{children:[a.jsx(u,{className:"w-4 h-4 mr-2"}),"Payment Done - Confirm Order"]})})]}),a.jsx("div",{className:"text-xs text-center text-muted-foreground",children:'Click "Payment Done" after completing payment in your UPI app'})]})]})]}),a.jsx("div",{className:"lg:col-span-1",children:a.jsxs(F,{className:"glass-card border-border/20 sticky top-24",children:[a.jsx(D,{children:a.jsx(I,{className:"font-serif-premium",children:"Order Summary"})}),a.jsxs(A,{className:"space-y-4",children:[a.jsx("div",{className:"space-y-3",children:ee.map((e,s)=>{const r=`${e.id}-${e.variant_id||"base"}-${e.combo_id||"none"}-${s}`;return a.jsxs("div",{className:"flex justify-between items-center",children:[a.jsxs("div",{className:"flex-1",children:[a.jsx("p",{className:"font-sans-premium text-sm text-foreground truncate",children:e.name}),a.jsxs("p",{className:"text-xs text-muted-foreground",children:["Qty: ",e.quantity]})]}),a.jsx("span",{className:"font-serif-premium text-sm text-accent",children:x(e.price*e.quantity)})]},r)})}),a.jsx($,{className:"bg-border/20"}),a.jsxs("div",{className:"space-y-4",children:[a.jsx("h4",{className:"font-sans-premium font-medium text-foreground",children:"Discount Code"}),Xe?a.jsxs("div",{className:"flex items-center justify-between p-3 bg-green-50 border border-green-200 rounded-lg",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(b,{className:"w-4 h-4 text-green-600"}),a.jsxs("span",{className:"text-sm font-medium text-green-800",children:[Xe.discount_name," applied"]}),a.jsxs("span",{className:"text-xs text-green-600",children:["-",x(Xe.discount_amount)]})]}),a.jsx(d,{onClick:()=>{Ye(null),We(""),Je(""),N.success("Coupon removed")},variant:"ghost",size:"sm",className:"text-green-600 hover:text-green-800",children:"Remove"})]}):a.jsxs("div",{className:"flex space-x-2",children:[a.jsx(g,{placeholder:"Enter coupon code",value:He,onChange:e=>We(e.target.value),className:"flex-1"}),a.jsx(d,{onClick:async()=>{if(He.trim()){es(!0),Je("");try{const e=await(async e=>{if(!e.trim())return{isValid:!1,message:"Please enter a coupon code"};try{const{data:s,error:a}=await t.from("discounts").select("*").eq("code",e.toLowerCase()).eq("is_active",!0).single();if(a||!s)return{isValid:!1,message:"Invalid coupon code"};const r=new Date;return s.end_date&&new Date(s.end_date)<r?{isValid:!1,message:"Coupon code has expired"}:s.start_date&&new Date(s.start_date)>r?{isValid:!1,message:"Coupon code is not yet active"}:s.usage_limit&&s.usage_count>=s.usage_limit?{isValid:!1,message:"Coupon code usage limit reached"}:{isValid:!0,discount:s}}catch(s){return console.error("Coupon validation error:",s),{isValid:!1,message:"Error validating coupon code"}}})(He);if(!e.isValid)return void Je(e.message||"Invalid coupon code");const s=await(async(e,s)=>{if(!e.length)return null;try{const{data:a,error:r}=await t.from("discounts").select("*").eq("is_active",!0).lte("start_date",(new Date).toISOString()).gte("end_date",(new Date).toISOString()).or("start_date.is.null,end_date.is.null");if(r)throw r;const n=e.reduce((e,s)=>e+(s.variant_price||s.combo_price||s.price)*s.quantity,0);let i=null;if(s&&(i=a?.find(a=>a.code?.toLowerCase()===s.toLowerCase()&&J(a,e,n))||null),i||(i=a?.find(s=>!s.code&&J(s,e,n))||null),!i)return null;const c=Z(i,n);return i.usage_limit&&i.usage_count>=i.usage_limit?{discount_id:i.id,discount_name:i.name,discount_code:i.code,discount_type:i.type,discount_value:i.value,discount_amount:0,original_amount:n,final_amount:n,is_applicable:!1,reason:"Discount usage limit reached"}:{discount_id:i.id,discount_name:i.name,discount_code:i.code,discount_type:i.type,discount_value:i.value,discount_amount:c,original_amount:n,final_amount:n-c,is_applicable:!0}}catch(a){return console.error("Discount calculation error:",a),null}})(ee,He);s&&s.is_applicable?(Ye(s),N.success(`Coupon applied! You saved ${x(s.discount_amount)}`)):Je(s?.reason||"Coupon not applicable")}catch(e){console.error("Coupon validation error:",e),Je("Failed to validate coupon code")}finally{es(!1)}}else Je("Please enter a coupon code")},disabled:Ze||!He.trim(),variant:"outline",size:"sm",children:Ze?"Applying...":"Apply"})]}),Ke&&a.jsx("p",{className:"text-sm text-red-600",children:Ke})]}),a.jsx($,{className:"bg-border/20"}),a.jsxs("div",{className:"space-y-2",children:[a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Subtotal"}),a.jsx("span",{className:"font-sans-premium text-foreground",children:x(se)})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Shipping"}),a.jsx("span",{className:"font-sans-premium text-foreground",children:0===is?"Free":x(is)})]}),a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Lucky Discount"}),a.jsxs("span",{className:"font-sans-premium text-green-600",children:["-",x(rs)]})]}),Xe&&a.jsxs("div",{className:"flex justify-between text-sm",children:[a.jsx("span",{className:"font-sans-premium text-muted-foreground",children:"Coupon Discount"}),a.jsxs("span",{className:"font-sans-premium text-green-600",children:["-",x(Xe.discount_amount)]})]})]}),a.jsx($,{className:"bg-border/20"}),a.jsxs("div",{className:"flex justify-between",children:[a.jsx("span",{className:"font-serif-premium text-lg text-foreground",children:"Total"}),a.jsx("span",{className:"font-serif-premium text-xl text-accent",children:x(ds)})]}),a.jsxs("div",{className:"mt-6 p-3 bg-accent/10 rounded-lg border border-accent/20",children:[a.jsxs("div",{className:"flex items-center space-x-2",children:[a.jsx(y,{className:"w-4 h-4 text-accent"}),a.jsx("span",{className:"font-sans-premium text-sm text-foreground",children:"Premium Benefits"})]}),a.jsxs("ul",{className:"mt-2 space-y-1 text-xs text-muted-foreground",children:[a.jsx("li",{children:"• Free returns within 30 days"}),a.jsx("li",{children:"• Authenticity guarantee"}),a.jsx("li",{children:"• White-glove customer service"})]})]})]})]})})]})})]})})})}export{ee as CheckoutPage};
