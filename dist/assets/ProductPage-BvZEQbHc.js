import{r as e,j as s}from"./ui-DmSYmwlh.js";import{c as a,g as r,f as t,B as c,Y as i,u as n,a as d,H as l,s as o,t as m}from"./index-sG1ZoleV.js";import{C as x,c as h,S as g}from"./separator-C5Dcbw9Z.js";import{I as u}from"./ImageWithFallback-D00OHxEV.js";import{A as p}from"./arrow-left-BDiTJN5X.js";import{S as j}from"./shopping-cart-D8ThiKve.js";import{T as f}from"./truck-BHGA4bM_.js";import"./vendor-CTYTkcnE.js";import"./supabase-CLG-Fze1.js";
/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const v=a("gem",[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]]),N=a("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),b=a("star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]),y=({variants:a,selectedVariant:c,onVariantSelect:i,basePrice:n,productName:d})=>{const[l,o]=e.useState(null),m=a.reduce((e,s)=>(e[s.variant_type]||(e[s.variant_type]=[]),e[s.variant_type].push(s),e),{});e.useEffect(()=>{!c&&a.length>0&&i(a[0])},[a,c,i]);const g=e=>{switch(e){case"packaging":return"Packaging";case"color":return"Color";case"size":return"Size";default:return"Options"}},u=e=>{if(e.price===n)return t(e.price);const s=e.price-n,a=s>0?"+":"";return`${t(e.price)} (${a}${t(Math.abs(s))})`};return s.jsxs("div",{className:"space-y-4",children:[Object.entries(m).map(([e,a])=>s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"text-sm font-medium text-foreground",children:g(e)}),s.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3",children:a.map(e=>{const a=c?.id===e.id;e.id;const d=(e=>{if(e.price<n){const s=n-e.price;return`Save ${t(s)}`}return null})(e);return s.jsx(x,{className:"cursor-pointer transition-all duration-200 "+(a?"ring-2 ring-accent bg-accent/5":"hover:ring-1 hover:ring-accent/50 hover:bg-accent/5"),onClick:()=>i(e),onMouseEnter:()=>o(e),onMouseLeave:()=>o(null),children:s.jsx(h,{className:"p-4",children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h5",{className:"font-medium text-foreground",children:e.variant_name}),d&&s.jsx(r,{variant:"secondary",className:"text-xs bg-green-100 text-green-800",children:d})]}),s.jsx("div",{className:"text-lg font-semibold text-accent",children:u(e)}),e.sku&&s.jsxs("div",{className:"text-xs text-muted-foreground font-mono",children:["SKU: ",e.sku]}),e.weight&&s.jsxs("div",{className:"text-xs text-muted-foreground",children:["Weight: ",e.weight,"g"]}),a&&s.jsxs("div",{className:"flex items-center gap-1 text-xs text-accent",children:[s.jsx("div",{className:"w-2 h-2 bg-accent rounded-full"}),"Selected"]})]})})},e.id)})})]},e)),c&&s.jsxs("div",{className:"mt-6 p-4 bg-muted/20 rounded-lg border border-border/20",children:[s.jsxs("h4",{className:"font-medium text-foreground mb-2",children:["Selected: ",c.variant_name]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Price:"}),s.jsx("span",{className:"ml-2 font-semibold text-accent",children:t(c.price)})]}),c.weight&&s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Weight:"}),s.jsxs("span",{className:"ml-2",children:[c.weight,"g"]})]}),c.sku&&s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground",children:"SKU:"}),s.jsx("span",{className:"ml-2 font-mono text-xs",children:c.sku})]}),c.dimensions&&s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground",children:"Dimensions:"}),s.jsxs("span",{className:"ml-2",children:[c.dimensions.length," × ",c.dimensions.width," × ",c.dimensions.height," cm"]})]})]})]})]})},_=({combo:e,onAddToCart:a})=>{const i=e.original_price-e.combo_price,n=Math.round(i/e.original_price*100);return s.jsx(x,{className:"border-2 border-accent/20 bg-gradient-to-br from-accent/5 to-accent/10",children:s.jsx(h,{className:"p-6",children:s.jsxs("div",{className:"space-y-4",children:[s.jsxs("div",{className:"text-center",children:[s.jsx("h3",{className:"text-xl font-serif text-foreground mb-2",children:e.name}),s.jsx("p",{className:"text-muted-foreground text-sm",children:e.description})]}),s.jsxs("div",{className:"text-center space-y-2",children:[s.jsxs("div",{className:"flex items-center justify-center gap-3",children:[s.jsx("span",{className:"text-2xl font-bold text-accent",children:t(e.combo_price)}),s.jsx("span",{className:"text-lg text-muted-foreground line-through",children:t(e.original_price)})]}),s.jsxs(r,{className:"bg-green-100 text-green-800 text-sm",children:["Save ",t(i)," (",n,"% off)"]})]}),s.jsxs("div",{className:"space-y-3",children:[s.jsx("h4",{className:"font-medium text-foreground",children:"This combo includes:"}),s.jsx("div",{className:"space-y-2",children:e.items.map((e,a)=>s.jsxs("div",{className:"flex items-center justify-between text-sm",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-2 h-2 bg-accent rounded-full"}),s.jsxs("span",{className:"text-foreground",children:[e.product?.name||"Product",e.variant?.variant_name&&` (${e.variant.variant_name})`]}),s.jsxs("span",{className:"text-muted-foreground",children:["× ",e.quantity]})]}),s.jsx("span",{className:"text-muted-foreground",children:t((e.variant?.price||e.product?.price||0)*e.quantity)})]},a))})]}),s.jsxs(c,{onClick:a,className:"w-full bg-accent text-accent-foreground hover:bg-accent/90",size:"lg",children:["Add Combo to Cart - ",t(e.combo_price)]})]})})})};function w(){const{slug:a}=i(),r=n(),[x,h]=e.useState(null),[w,k]=e.useState([]),[S,C]=e.useState([]),[$,z]=e.useState(null),[P,M]=e.useState(1),[F,q]=e.useState(0),{addToCart:A,addVariantToCart:T,addComboToCart:V,isLoading:L}=d();e.useEffect(()=>{(async()=>{if(a)try{const{data:e,error:s}=await o.from("products").select("id, name, slug, brand, price, description, stock, is_active, rating, review_count, origin, strength, pack_size, specifications, ingredients, gallery_images, meta_title, meta_description").eq("slug",a).single();if(s)return void m.error("Failed to fetch product details.");h(e);const{data:r,error:t}=await o.from("product_variants").select("\n            *,\n            variant_images (*)\n          ").eq("product_id",e.id).eq("is_active",!0).order("sort_order");!t&&r&&k(r);const{data:c,error:i}=await o.from("product_combos").select("\n            *,\n            combo_items (\n              *,\n              products (*),\n              product_variants (*)\n            )\n          ").eq("is_active",!0).contains("combo_items.product_id",[e.id]);!i&&c&&C(c)}catch(e){console.error("Error fetching product data:",e),m.error("Failed to load product details.")}})()},[a]);if(!x)return s.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center",children:s.jsx("p",{children:"Loading..."})});const E=$&&$.images&&$.images.length>0?$.images.map(e=>e.image_url):x.gallery_images||[];return s.jsxs(s.Fragment,{children:[s.jsxs(l,{children:[s.jsx("title",{children:x?.meta_title||x?.name||"Product"}),s.jsx("meta",{name:"description",content:x?.meta_description||x?.description||"Premium tobacco product"})]}),s.jsx("div",{className:"min-h-screen bg-background text-foreground",children:s.jsxs("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[s.jsxs(c,{variant:"ghost",onClick:()=>r(-1),className:"mb-8 text-muted-foreground hover:text-foreground",children:[s.jsx(p,{className:"w-4 h-4 mr-2"}),"Back"]}),s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:[s.jsxs("div",{children:[s.jsx("div",{className:"aspect-square rounded-lg overflow-hidden border border-border/20 mb-4",children:s.jsx(u,{src:E[F],alt:x.name,className:"w-full h-full object-cover"})}),s.jsx("div",{className:"flex space-x-2",children:E.map((e,a)=>s.jsx("button",{className:"w-16 h-16 rounded-md overflow-hidden border-2 "+(F===a?"border-accent":"border-transparent"),onClick:()=>q(a),children:s.jsx(u,{src:e,alt:`${x.name} thumbnail ${a+1}`,className:"w-full h-full object-cover"})},a))})]}),s.jsxs("div",{className:"py-4",children:[s.jsx("p",{className:"text-sm text-muted-foreground font-sans-premium",children:x.brand}),s.jsx("h1",{className:"font-serif-premium text-4xl sm:text-5xl text-foreground my-2",children:x.name}),s.jsxs("div",{className:"flex items-center space-x-2 text-muted-foreground mb-4",children:[s.jsx(b,{className:"w-4 h-4 text-accent fill-accent"}),s.jsx("span",{children:x.rating}),s.jsxs("span",{children:["(",x.review_count," reviews)"]})]}),s.jsxs("div",{className:"my-6",children:[s.jsxs("p",{className:"font-serif-premium text-5xl text-foreground",children:[t($?$.price:x.price),$&&s.jsxs("span",{className:"text-lg text-muted-foreground ml-2",children:["(",$.variant_name,")"]})]}),$&&$.price!==x.price&&s.jsx("p",{className:"text-sm text-muted-foreground line-through",children:t(x.price)})]}),w.length>0&&s.jsxs("div",{className:"mb-8",children:[s.jsx("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"Select Variant"}),s.jsx(y,{variants:w,selectedVariant:$,onVariantSelect:z,basePrice:x.price,productName:x.name})]}),s.jsx("p",{className:"text-muted-foreground leading-relaxed mb-8",children:x.description}),s.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm mb-8",children:[s.jsxs("div",{children:[s.jsx("strong",{className:"block text-foreground",children:"Origin"})," ",x.origin]}),s.jsxs("div",{children:[s.jsx("strong",{className:"block text-foreground",children:"Strength"})," ",x.strength]}),s.jsxs("div",{children:[s.jsx("strong",{className:"block text-foreground",children:"Category"})," Classic"]}),s.jsxs("div",{children:[s.jsx("strong",{className:"block text-foreground",children:"Pack Size"})," ",x.pack_size]})]}),s.jsxs("div",{className:"flex items-center space-x-4 mb-8",children:[s.jsxs("div",{className:"flex items-center border border-border/20 rounded-md",children:[s.jsx(c,{variant:"ghost",size:"lg",onClick:()=>M(e=>Math.max(1,e-1)),children:"-"}),s.jsx("span",{className:"w-16 text-center font-bold text-lg",children:P}),s.jsx(c,{variant:"ghost",size:"lg",onClick:()=>M(e=>e+1),children:"+"})]}),s.jsxs(c,{onClick:async()=>{if(x)try{if($)await T(x,$,P),m.success(`${x.name} ${$.variant_name} (x${P}) added to cart`);else{const e={id:x.id,name:x.name,slug:x.slug,brand:x.brand,price:x.price,description:x.description,is_active:x.is_active,gallery_images:x.gallery_images,rating:x.rating,review_count:x.review_count};await A(e,P),m.success(`${x.name} (x${P}) added to cart`)}}catch(e){m.error("Failed to add to cart")}},disabled:L||!x.is_active,className:"flex-1 gold-gradient text-primary",size:"lg",children:[s.jsx(j,{className:"w-5 h-5 mr-2"}),L?"Adding...":"Add to Cart"]})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-4 text-center text-muted-foreground text-sm",children:[s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(f,{className:"w-6 h-6 mb-2 text-accent"})," Free Shipping"]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(N,{className:"w-6 h-6 mb-2 text-accent"})," Secure Payment"]}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx(v,{className:"w-6 h-6 mb-2 text-accent"})," Premium Quality"]})]})]})]}),s.jsx(g,{className:"my-12 bg-border/20"}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-12",children:[s.jsxs("div",{children:[s.jsx("h2",{className:"font-serif-premium text-3xl text-foreground mb-4",children:"Specifications"}),s.jsx("div",{className:"space-y-2 text-muted-foreground",children:x.specifications&&Object.entries(x.specifications).map(([e,a])=>s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{children:e}),s.jsx("span",{className:"text-foreground",children:String(a)})]},e))})]}),s.jsxs("div",{children:[s.jsx("h2",{className:"font-serif-premium text-3xl text-foreground mb-4",children:"Ingredients"}),s.jsx("ul",{className:"list-disc list-inside space-y-2 text-muted-foreground",children:x.ingredients?.map((e,a)=>s.jsx("li",{children:e},a))})]})]}),S.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(g,{className:"my-12 bg-border/20"}),s.jsxs("div",{className:"mb-12",children:[s.jsx("h2",{className:"font-serif-premium text-3xl text-foreground mb-8 text-center",children:"Available Combo Packs"}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:S.map(e=>s.jsx(_,{combo:e,onAddToCart:()=>(async e=>{try{await V(e,P),m.success(`${e.name} (x${P}) added to cart`)}catch(s){m.error("Failed to add combo to cart")}})(e)},e.id))})]})]})]})})]})}export{w as ProductPage};
